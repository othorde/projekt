{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Othor\\\\dbwebb-kurser\\\\frontendphp\\\\webbclient\\\\src\\\\components\\\\History\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport { React, useState, useEffect, useContext } from \"react\"; //components\n\nimport MapForUser from '../../components/MapForUser/index';\nimport Loader from '../../components/loader/loader'; // hook\n\nimport { useFetchAUser } from '../../Hooks/useFetchAUser';\nimport { useFetchAllCities } from '../../Hooks/useFetchAllCities'; //styles\n\nimport { Container, Main, UserHistory, MapContainer } from './Form.styles'; //other\n\nimport { checkIfCoordInParkingZone, checkIfCoordInChargingPost } from '../../helperfunction/helpers';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialValue = {\n  showMap: false,\n  startCoord: \"\",\n  stopCoord: \"\"\n};\n\nconst History = props => {\n  _s();\n\n  let user;\n  let id; // För att bestämma vilka props som ska användas\n\n  if (props && props.user) {\n    user = props.user;\n    id = props.user.value.id;\n  } else if (props && props.customer) {\n    id = props.customer.id;\n  }\n\n  const {\n    aUser,\n    aUserMessage,\n    aUserLoading\n  } = useFetchAUser(id);\n  const {\n    cities,\n    messageCities,\n    loadingCities\n  } = useFetchAllCities();\n  const [showMapForUser, setShowMapForUser] = useState(initialValue);\n  const [allCharging_posts, setAllCharging_posts] = useState([]); //parkering \n\n  const [allParkingZones, setAllParkingZones] = useState([]); // laddstationer\n\n  const [userInvoice, setUserInvoice] = useState([]);\n  /* Loopa städer, sätt värden till state */\n\n  const getAllCities = async () => {\n    if (cities) {\n      cities.forEach(city => {\n        setAllCharging_posts(city.charging_posts);\n        setAllParkingZones(city.parking_zones);\n      });\n    }\n  };\n\n  useEffect(() => {\n    getAllCities();\n    checkAllUsersTrips();\n  }, [user, aUser, aUserMessage, cities]);\n  /* rendera om setUserInvoice ändras */\n\n  useEffect(() => {}, [setUserInvoice, userInvoice, loadingCities, aUserLoading]);\n  /* rendera om kartan ska visas */\n\n  useEffect(() => {}, [showMapForUser, setShowMapForUser]);\n  /* Räknar ut kunds pris */\n\n  const checkUserPrices = (startAtParkingZone, startChargePoint, endedAtParkingZone, endedAtChargePoint, time) => {\n    let prices = {\n      startFee: 10,\n      discount: 0,\n      minFee: 2.5 * time\n    };\n    /* Om en resa börjar i fri parkering och slutar på en definerad blir startavg lägre */\n\n    if (startAtParkingZone && startAtParkingZone.returned === false || startChargePoint && startChargePoint.returned === false) {\n      if (endedAtParkingZone && endedAtParkingZone.returned === true || endedAtChargePoint && endedAtChargePoint.returned === true) {\n        prices.startFee = 8;\n        prices.discount = 2;\n        return prices;\n      }\n    }\n    /* startavg högre (12) om man ej lämnar inom stationerna */\n\n\n    if (endedAtParkingZone && endedAtParkingZone.returned === false && endedAtChargePoint && endedAtChargePoint.returned === false) {\n      prices.startFee = 12;\n      return prices;\n    }\n\n    return prices;\n  };\n  /* Loopar igenom alla användarens resor och \n      kontrollerar resedetaljer mha de andra funktionerna\n  */\n\n\n  function checkAllUsersTrips() {\n    let arrayOfTrips = [];\n    aUser.forEach(trip => {\n      let time = getTimeOfTrip(trip.start.time, trip.stop.time);\n      let tripEnded = [trip.stop.position.lat, trip.stop.position.lng];\n      let tripStarted = [trip.start.position.lat, trip.start.position.lng];\n      let startAtParkingZone = checkIfCoordInParkingZone(tripStarted, allParkingZones);\n      let endedAtParkingZone = checkIfCoordInParkingZone(tripEnded, allParkingZones);\n      let startChargePoint = checkIfCoordInChargingPost(tripStarted, allCharging_posts);\n      let endedAtChargePoint = checkIfCoordInChargingPost(tripEnded, allCharging_posts);\n      let prices = checkUserPrices(startAtParkingZone, startChargePoint, endedAtParkingZone, endedAtChargePoint, time);\n      const atrip = {\n        tripId: trip.id,\n        date: trip.date,\n        startTime: trip.start.time,\n        stopTime: trip.stop.time,\n        tripStartedPos: tripStarted,\n        tripEndedPos: tripEnded,\n        startAtParkingZone: startAtParkingZone,\n        endedAtParkingZone: endedAtParkingZone,\n        startChargePoint: startChargePoint,\n        endedAtChargePoint: endedAtChargePoint,\n        timeOfTrip: time,\n        startFee: prices.startFee,\n        timeFee: prices.minFee,\n        discount: prices.discount,\n        totalCost: prices.minFee + prices.startFee\n      };\n      arrayOfTrips.push(atrip);\n    });\n    setUserInvoice(arrayOfTrips);\n  }\n  /* Räknar ut tiden för resan, gör om till sekunder \n      subtraherar och dividerar för att få ut minuter\n  */\n\n\n  function getTimeOfTrip(starttime, stoptime) {\n    var arrStarttime = starttime.split(\".\");\n    var arrStoptime = stoptime.split(\".\");\n    arrStarttime[0] = arrStarttime[0] * 60 * 60;\n    arrStarttime[1] = arrStarttime[1] * 60;\n    arrStoptime[0] = arrStoptime[0] * 60 * 60;\n    arrStoptime[1] = arrStoptime[1] * 60;\n    var stopTime = arrStoptime[0] + arrStoptime[1];\n    var startTime = arrStarttime[0] + arrStarttime[1];\n    var time = (stopTime - startTime) / 60;\n    return time;\n  }\n  /*  visa kartar upp karta, beroende på var användaren klickar */\n\n\n  function showMap(startCoord, stopCoord, e) {\n    let pageY = e.pageY;\n\n    if (props && props.customer) {\n      pageY = pageY - 200;\n    }\n\n    setShowMapForUser({\n      showMap: !showMapForUser.showMap,\n      startCoord: startCoord,\n      stopCoord: stopCoord,\n      pageY: pageY\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(Main, {\n      showMap: showMapForUser.showMap,\n      children: /*#__PURE__*/_jsxDEV(UserHistory, {\n        children: userInvoice.length > 0 && !loadingCities && !aUserLoading ? /*#__PURE__*/_jsxDEV(\"table\", {\n          children: [/*#__PURE__*/_jsxDEV(\"caption\", {\n            children: \" Historik \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Datum\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 180,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Starttid\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 181,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Sluttid\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 182,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Total tid\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 183,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Start avgift\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Rabatt\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 185,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Tid avgift\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Visa p\\xE5 karta\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Total kostnad\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: userInvoice.map(elem => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Datum\",\n                children: [\" \", elem.date, \" \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Starttid\",\n                children: [elem.startTime, \" \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 195,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Sluttid\",\n                children: [elem.stopTime, \" \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 196,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Total tid\",\n                children: [elem.timeOfTrip, \" min \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 197,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Start avgift\",\n                children: [elem.startFee, \":-\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 198,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Rabatt\",\n                children: [elem.discount, \":- \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 199,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Minutpris\",\n                children: [elem.timeFee, \":- \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Visa p\\xE5 karta\",\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"button vertical-align:middle\",\n                  onClick: e => showMap(elem.tripStartedPos, elem.tripEndedPos, e),\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"F\\xE4rd \"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 203,\n                    columnNumber: 89\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 202,\n                  columnNumber: 35\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 201,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                \"data-label\": \"Total kostnad\",\n                children: [elem.totalCost, \":- \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 33\n              }, this)]\n            }, elem.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 29\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 21\n        }, this) : /*#__PURE__*/_jsxDEV(Loader, {\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"p\", {\n            children: aUserMessage || messageCities\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 34\n          }, this), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(MapContainer, {\n      showMap: showMapForUser.showMap,\n      pageY: showMapForUser.pageY,\n      children: showMapForUser.showMap && /*#__PURE__*/_jsxDEV(MapForUser, {\n        showMapForUser: showMapForUser,\n        children: \" \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 172,\n    columnNumber: 9\n  }, this);\n};\n\n_s(History, \"PIPPY+yow4tcKUUjnszyV2s/02s=\", false, function () {\n  return [useFetchAUser, useFetchAllCities];\n});\n\n_c = History;\nexport default History;\n\nvar _c;\n\n$RefreshReg$(_c, \"History\");","map":{"version":3,"sources":["C:/Users/Othor/dbwebb-kurser/frontendphp/webbclient/src/components/History/index.js"],"names":["React","useState","useEffect","useContext","MapForUser","Loader","useFetchAUser","useFetchAllCities","Container","Main","UserHistory","MapContainer","checkIfCoordInParkingZone","checkIfCoordInChargingPost","initialValue","showMap","startCoord","stopCoord","History","props","user","id","value","customer","aUser","aUserMessage","aUserLoading","cities","messageCities","loadingCities","showMapForUser","setShowMapForUser","allCharging_posts","setAllCharging_posts","allParkingZones","setAllParkingZones","userInvoice","setUserInvoice","getAllCities","forEach","city","charging_posts","parking_zones","checkAllUsersTrips","checkUserPrices","startAtParkingZone","startChargePoint","endedAtParkingZone","endedAtChargePoint","time","prices","startFee","discount","minFee","returned","arrayOfTrips","trip","getTimeOfTrip","start","stop","tripEnded","position","lat","lng","tripStarted","atrip","tripId","date","startTime","stopTime","tripStartedPos","tripEndedPos","timeOfTrip","timeFee","totalCost","push","starttime","stoptime","arrStarttime","split","arrStoptime","e","pageY","length","map","elem"],"mappings":"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","sourcesContent":["import {React, useState, useEffect, useContext} from \"react\";\n\n//components\nimport MapForUser from '../../components/MapForUser/index'\nimport Loader from '../../components/loader/loader'\n// hook\nimport {useFetchAUser} from '../../Hooks/useFetchAUser'\nimport {useFetchAllCities} from '../../Hooks/useFetchAllCities'\n//styles\nimport {Container, Main, UserHistory, MapContainer} from './Form.styles'\n//other\nimport {checkIfCoordInParkingZone, checkIfCoordInChargingPost } from '../../helperfunction/helpers'\n\nconst initialValue = {\n    showMap: false,\n    startCoord: \"\",\n    stopCoord: \"\",\n}\n\nconst History = (props)  => {\n    let user;\n    let id;\n    \n    // För att bestämma vilka props som ska användas\n    if(props && props.user) {\n        user = props.user;\n        id = props.user.value.id\n    } else if ( props && props.customer) {\n        id = props.customer.id;\n    }\n\n    const {aUser, aUserMessage, aUserLoading} = useFetchAUser( id);\n    const {cities, messageCities, loadingCities} = useFetchAllCities(); \n    const [showMapForUser, setShowMapForUser] = useState(initialValue);\n    const [allCharging_posts, setAllCharging_posts] = useState([]) //parkering \n    const [allParkingZones, setAllParkingZones] = useState([]) // laddstationer\n    const [userInvoice, setUserInvoice] = useState([])\n\n    /* Loopa städer, sätt värden till state */\n    const getAllCities = async () => {\n        if (cities) {\n            cities.forEach(city => {\n                setAllCharging_posts(city.charging_posts)\n                setAllParkingZones(city.parking_zones)\n            });\n        }\n    }\n\n    useEffect(() => {\n        getAllCities()\n        checkAllUsersTrips()\n    }, [user, aUser, aUserMessage, cities])\n\n    /* rendera om setUserInvoice ändras */\n    useEffect(() => {\n    }, [setUserInvoice, userInvoice, loadingCities, aUserLoading])\n\n\n    /* rendera om kartan ska visas */\n    useEffect(() => {\n    }, [showMapForUser, setShowMapForUser])\n    \n\n    /* Räknar ut kunds pris */\n    const checkUserPrices = (startAtParkingZone, startChargePoint, endedAtParkingZone, endedAtChargePoint, time) => {\n\n            let prices = {\n                startFee: 10,\n                discount: 0,\n                minFee: 2.5 * time,\n            }\n        \n            /* Om en resa börjar i fri parkering och slutar på en definerad blir startavg lägre */\n            if((startAtParkingZone && startAtParkingZone.returned === false)\n            || (startChargePoint && startChargePoint.returned === false)) {\n                if ((endedAtParkingZone && endedAtParkingZone.returned === true) \n                || (endedAtChargePoint && endedAtChargePoint.returned === true)) {\n                    prices.startFee = 8;\n                    prices.discount = 2;\n                    return prices\n                }\n            }\n\n            /* startavg högre (12) om man ej lämnar inom stationerna */\n            if((endedAtParkingZone && endedAtParkingZone.returned === false)\n                && (endedAtChargePoint && endedAtChargePoint.returned === false)) {\n                    prices.startFee = 12;\n                    return prices\n            }\n        return prices\n    }\n\n    /* Loopar igenom alla användarens resor och \n        kontrollerar resedetaljer mha de andra funktionerna\n    */\n    function checkAllUsersTrips() {\n\n        let arrayOfTrips = []\n\n        aUser.forEach(trip => {\n\n            let time = getTimeOfTrip(trip.start.time, trip.stop.time)\n            let tripEnded = [trip.stop.position.lat, trip.stop.position.lng];\n            let tripStarted = [trip.start.position.lat, trip.start.position.lng];\n            let startAtParkingZone = checkIfCoordInParkingZone(tripStarted, allParkingZones);\n            let endedAtParkingZone = checkIfCoordInParkingZone(tripEnded, allParkingZones);\n            let startChargePoint = checkIfCoordInChargingPost(tripStarted, allCharging_posts);\n            let endedAtChargePoint = checkIfCoordInChargingPost(tripEnded, allCharging_posts);\n            let prices = checkUserPrices(startAtParkingZone, startChargePoint, endedAtParkingZone, endedAtChargePoint, time);\n\n            const atrip = { \n                tripId: trip.id,\n                date: trip.date,\n                startTime: trip.start.time,\n                stopTime: trip.stop.time,\n                tripStartedPos: tripStarted,\n                tripEndedPos: tripEnded,\n                startAtParkingZone: startAtParkingZone,\n                endedAtParkingZone: endedAtParkingZone,\n                startChargePoint: startChargePoint,\n                endedAtChargePoint: endedAtChargePoint,\n                timeOfTrip: time,\n                startFee: prices.startFee,\n                timeFee: prices.minFee,\n                discount: prices.discount,\n                totalCost: (prices.minFee + prices.startFee)\n            }\n            arrayOfTrips.push(atrip);\n        })\n        setUserInvoice(arrayOfTrips)\n\n        \n    }\n\n    /* Räknar ut tiden för resan, gör om till sekunder \n        subtraherar och dividerar för att få ut minuter\n    */\n    function getTimeOfTrip(starttime, stoptime) {\n\n        var arrStarttime = starttime.split(\".\");\n        var arrStoptime = stoptime.split(\".\"); \n\n        arrStarttime[0] = arrStarttime[0] * 60 * 60;\n        arrStarttime[1] = arrStarttime[1] * 60;\n        arrStoptime[0] = arrStoptime[0] * 60 * 60;\n        arrStoptime[1] = arrStoptime[1] * 60;\n        \n        var stopTime = arrStoptime[0] + arrStoptime[1];\n        var startTime = arrStarttime[0] + arrStarttime[1];\n        var time = (stopTime - startTime) / 60;\n\n        return time\n    }\n\n    /*  visa kartar upp karta, beroende på var användaren klickar */\n    function showMap(startCoord, stopCoord, e) {\n\n        let pageY = e.pageY;\n            if(props && props.customer) {\n                pageY = pageY - 200;\n            }\n\n        setShowMapForUser({\n            showMap: !showMapForUser.showMap,\n            startCoord: startCoord,\n            stopCoord: stopCoord,\n            pageY: pageY\n        })\n    }\n\n\treturn (\n        <Container>  \n            <Main showMap = {showMapForUser.showMap} >\n                <UserHistory> \n                    {userInvoice.length > 0 && !loadingCities && !aUserLoading ? (\n                    <table>\n                        <caption> Historik </caption>\n                        <thead>\n                            <tr>\n                                <th scope=\"col\">Datum</th>\n                                <th scope=\"col\">Starttid</th>\n                                <th scope=\"col\">Sluttid</th>\n                                <th scope=\"col\">Total tid</th>\n                                <th scope=\"col\">Start avgift</th>\n                                <th scope=\"col\">Rabatt</th>\n                                <th scope=\"col\">Tid avgift</th>\n                                <th scope=\"col\">Visa på karta</th>\n                                <th scope=\"col\">Total kostnad</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {userInvoice.map(elem => \n                            <tr key={elem.id}>\n                                <td data-label=\"Datum\"> {elem.date} </td>\n                                <td data-label=\"Starttid\">{elem.startTime} </td>\n                                <td data-label=\"Sluttid\">{elem.stopTime} </td>\n                                <td data-label=\"Total tid\">{elem.timeOfTrip} min </td>\n                                <td data-label=\"Start avgift\" >{elem.startFee}:-</td>\n                                <td data-label=\"Rabatt\">{elem.discount}:- </td>\n                                <td data-label=\"Minutpris\">{elem.timeFee}:- </td>\n                                <td data-label=\"Visa på karta\" >\n                                { <button className=\"button vertical-align:middle\" onClick={(e) => \n                                    showMap(elem.tripStartedPos, elem.tripEndedPos, e)}><span>Färd </span></button>}\n                                </td>\n                                <td data-label=\"Total kostnad\">{elem.totalCost}:- </td>\n                            </tr>\n                            )}\n                        </tbody>\n                        </table>\n                        ) : (\n                        <Loader> <p>{aUserMessage || messageCities}</p> </Loader>\n                    )}\n                </UserHistory>\n            </Main>\n            <MapContainer showMap = {showMapForUser.showMap} pageY={showMapForUser.pageY} >\n                {showMapForUser.showMap &&\n                    <MapForUser showMapForUser = {showMapForUser}> </MapForUser>\n                }\n            </MapContainer>\n        </Container>\n    )\n}\n\nexport default History\n"]},"metadata":{},"sourceType":"module"}