{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Othor\\\\dbwebb-kurser\\\\frontendphp\\\\webbclient\\\\src\\\\components\\\\landingPage\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\"; // components\n\nimport Loader from '../loader/loader'; // style\n\nimport { Wrapper } from \"./Form.styles\"; //other\n\nimport AppContext from \"../../AppContext\";\nimport Api from \"../../api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nrequire('dotenv').config();\n\nexport default function LandingPage() {\n  _s();\n\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n  const myContext = useContext(AppContext);\n  useEffect(() => {\n    // Hämtar url från webbläsare\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\"); // Om github skickar tillbaka kod\n\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      const requestData = {\n        code: newUrl[1]\n      }; // skickar till backend vad den ska göra\n\n      const proxy_url = \"http://localhost:1337/api/oauth/authenticate\";\n\n      async function getGitInfo() {\n        const defaultConfig = {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            \"Access-Control-Allow-Origin\": \"*\"\n          }\n        };\n\n        try {\n          const endpoint = `${proxy_url}`;\n          let res;\n          let result;\n          res = await (await fetch(endpoint, { ...defaultConfig,\n            body: JSON.stringify({\n              code: requestData.code\n            })\n          })).json();\n          /* HÄR MÅSTE KOLLA SÅ ATT LOGGIN ÄR OK FRÅN VÅRT API SÄTT SEN ALLA PARAMETRAR TILL ANVÄNDAREN\n          \tFIXA SEN SÅ ATT HAN NAVIGERAS VIDARE TILL LOGINHOME\n          */\n          // Om backend skickar användaruppg, be sen om att logga in användaren\n\n          if (res && res.login) {\n            result = await Api.logginUserViaGit(res.login);\n\n            if (result && result.data.type === \"success\") {\n              localStorage.clear();\n              localStorage.setItem('user', JSON.stringify(res.login));\n              localStorage.setItem('tag', JSON.stringify(result.data.user.tag));\n              localStorage.setItem('id', JSON.stringify(result.data.user.id));\n              const user = {};\n              myContext.toggleAuth(true);\n              setLoggedInUser(true);\n            }\n          } else {\n            setLoggedInUser(\"Not OK\");\n            myContext.toggleAuth(false);\n          }\n        } catch (error) {\n          console.log(error);\n          setLoggedInUser(\"Not OK\");\n          myContext.toggleAuth(false);\n        }\n      }\n\n      getGitInfo();\n    }\n  }, []);\n  useEffect(() => {\n    let tag = localStorage.getItem(\"tag\");\n\n    if (loggedInUser === true && tag) {\n      navigate(\"/login/home\");\n    }\n  }, [loggedInUser, setLoggedInUser]);\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: !loggedInUser == \"Not OK\" ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Det gick inte att logga in just nu\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 3\n    }, this) : /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 10\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 5\n  }, this);\n}\n\n_s(LandingPage, \"wUqvUK37ZuzBwWQzbG3ZOQ+Tb70=\", false, function () {\n  return [useNavigate];\n});\n\n_c = LandingPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"LandingPage\");","map":{"version":3,"sources":["C:/Users/Othor/dbwebb-kurser/frontendphp/webbclient/src/components/landingPage/index.js"],"names":["React","useState","useEffect","useContext","useNavigate","Loader","Wrapper","AppContext","Api","require","config","LandingPage","loggedInUser","setLoggedInUser","Boolean","navigate","myContext","url","window","location","href","hasCode","includes","newUrl","split","history","pushState","requestData","code","proxy_url","getGitInfo","defaultConfig","method","headers","endpoint","res","result","fetch","body","JSON","stringify","json","login","logginUserViaGit","data","type","localStorage","clear","setItem","user","tag","id","toggleAuth","error","console","log","getItem"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n// components\nimport Loader from '../loader/loader'\n// style\nimport {Wrapper} from \"./Form.styles\";\n//other\nimport AppContext from \"../../AppContext\";\nimport Api from \"../../api\";\n\n\nrequire('dotenv').config()\n\n\nexport default function LandingPage() {\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n  const myContext = useContext(AppContext);        \n\n  useEffect(() => {\n    // Hämtar url från webbläsare\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\");\n\n    // Om github skickar tillbaka kod\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      \n      const requestData = {\n        code: newUrl[1]\n      };\n\n\t  // skickar till backend vad den ska göra\n      const proxy_url = \"http://localhost:1337/api/oauth/authenticate\";\n\t\tasync function getGitInfo() {\n\t\t\tconst defaultConfig = {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\"Access-Control-Allow-Origin\": \"*\"\n\t\t\t\t},\n\t\t\t};\n\n\t\ttry {\n\t\t\tconst endpoint = `${proxy_url}`;\n\t\t\tlet res;\n\t\t\tlet result;\n\t\t\tres = await (\n\t\t\t\tawait fetch(endpoint, {\n\t\t\t\t\t...defaultConfig,\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tcode: requestData.code,\n\t\t\t\t\t})\n\t\t\t\t})).json();\n\n\t\t\t/* HÄR MÅSTE KOLLA SÅ ATT LOGGIN ÄR OK FRÅN VÅRT API SÄTT SEN ALLA PARAMETRAR TILL ANVÄNDAREN\n\t\t\t\tFIXA SEN SÅ ATT HAN NAVIGERAS VIDARE TILL LOGINHOME\n\t\t\t*/\n\t\t\t// Om backend skickar användaruppg, be sen om att logga in användaren\n\t\t\tif (res && res.login) {\n\t\t\t\tresult = await Api.logginUserViaGit(res.login)\n\t\t\t\tif (result && result.data.type === \"success\") {\n\t\t\t\t\tlocalStorage.clear();\n\t\t\t\t\tlocalStorage.setItem('user', JSON.stringify(res.login));\n\t\t\t\t\tlocalStorage.setItem('tag', JSON.stringify(result.data.user.tag));\n\t\t\t\t\tlocalStorage.setItem('id', JSON.stringify(result.data.user.id));\n\n\t\t\t\t\tconst user = {\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t\tmyContext.toggleAuth(true);\n\t\t\t\t\tsetLoggedInUser(true)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetLoggedInUser(\"Not OK\")\n\t\t\t\tmyContext.toggleAuth(false);\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.log((error))\n\t\t\tsetLoggedInUser(\"Not OK\")\n\t\t\tmyContext.toggleAuth(false);\n\t\t}\n\t}\n\tgetGitInfo();\n\t}\n  }, []);\n\n\t\n\tuseEffect(() => {\n\t\tlet tag = localStorage.getItem(\"tag\");\n\t\tif(loggedInUser === true && tag) {\n\t\t\tnavigate(\"/login/home\")\n\t\t}\n\t}, [loggedInUser, setLoggedInUser])\n\n\n\n\n  return (\n    <Wrapper>\n\t\t{!loggedInUser == \"Not OK\" ? \n\t\t<p>Det gick inte att logga in just nu</p> \n\t\t: (\n        \t<Loader></Loader>\n\t\t)}\n    </Wrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}