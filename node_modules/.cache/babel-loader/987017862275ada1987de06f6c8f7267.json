{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Othor\\\\dbwebb-kurser\\\\frontendphp\\\\webbclient\\\\src\\\\components\\\\landingPage\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\"; // components\n\nimport Loader from '../loader/loader'; // style\n\nimport { Wrapper } from \"./Form.styles\"; //other\n\nimport AppContext from \"../../AppContext\";\nimport Api from \"../../api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nrequire('dotenv').config();\n\nexport default function LandingPage() {\n  _s();\n\n  const [data, setData] = useState({\n    errorMessage: \"\",\n    isLoading: false\n  });\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n  const myContext = useContext(AppContext);\n  useEffect(() => {\n    // Hämtar url från webbläsare\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\"); // Om github skickar tillbaka kod\n\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      setData({ ...data,\n        isLoading: true\n      });\n      const requestData = {\n        code: newUrl[1]\n      }; // skickar till backend vad den ska göra\n\n      const proxy_url = \"http://localhost:1337/api/oauth/authenticate\";\n\n      async function getGitInfo() {\n        const defaultConfig = {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            \"Access-Control-Allow-Origin\": \"*\"\n          }\n        };\n\n        try {\n          const endpoint = `${proxy_url}`;\n          let res;\n          let result;\n          res = await (await fetch(endpoint, { ...defaultConfig,\n            body: JSON.stringify({\n              code: requestData.code\n            })\n          })).json();\n          /* HÄR MÅSTE KOLLA SÅ ATT LOGGIN ÄR OK FRÅN VÅRT API SÄTT SEN ALLA PARAMETRAR TILL ANVÄNDAREN\n          \tFIXA SEN SÅ ATT HAN NAVIGERAS VIDARE TILL LOGINHOME\n          */\n          // Om backend skickar användaruppg, be sen om att logga in användaren\n\n          if (res && res.login) {\n            result = await Api.logginUserViaGit(res.login);\n\n            if (result && result.data.type === \"success\") {\n              localStorage.clear();\n              localStorage.setItem('user', JSON.stringify(res.login));\n              localStorage.setItem('tag', JSON.stringify(result.data.user.tag));\n              myContext.toggleAuth(true);\n              setLoggedInUser(true);\n            }\n          } else {\n            setLoggedInUser(false);\n            myContext.toggleAuth(false);\n          }\n        } catch (error) {\n          console.log(error);\n        }\n      }\n\n      getGitInfo();\n    }\n  }, [data]);\n  useEffect(() => {\n    if (loggedInUser === true) {\n      navigate(\"/login/home\");\n    }\n  }, [loggedInUser, setLoggedInUser]);\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: !loggedInUser ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Det gick inte att logga in just nu\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 3\n    }, this) : /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 10\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n}\n\n_s(LandingPage, \"uV6wFxRFIk8SMlvNVEtwyzmxyGY=\", false, function () {\n  return [useNavigate];\n});\n\n_c = LandingPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"LandingPage\");","map":{"version":3,"sources":["C:/Users/Othor/dbwebb-kurser/frontendphp/webbclient/src/components/landingPage/index.js"],"names":["React","useState","useEffect","useContext","useNavigate","Loader","Wrapper","AppContext","Api","require","config","LandingPage","data","setData","errorMessage","isLoading","loggedInUser","setLoggedInUser","Boolean","navigate","myContext","url","window","location","href","hasCode","includes","newUrl","split","history","pushState","requestData","code","proxy_url","getGitInfo","defaultConfig","method","headers","endpoint","res","result","fetch","body","JSON","stringify","json","login","logginUserViaGit","type","localStorage","clear","setItem","user","tag","toggleAuth","error","console","log"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,UAArC,QAAuD,OAAvD;AACA,SAASC,WAAT,QAA4B,kBAA5B,C,CACA;;AACA,OAAOC,MAAP,MAAmB,kBAAnB,C,CACA;;AACA,SAAQC,OAAR,QAAsB,eAAtB,C,CACA;;AACA,OAAOC,UAAP,MAAuB,kBAAvB;AACA,OAAOC,GAAP,MAAgB,WAAhB;;;AAGAC,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAAlB;;AAGA,eAAe,SAASC,WAAT,GAAuB;AAAA;;AACpC,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBZ,QAAQ,CAAC;AAAEa,IAAAA,YAAY,EAAE,EAAhB;AAAoBC,IAAAA,SAAS,EAAE;AAA/B,GAAD,CAAhC;AACA,QAAM,CAACC,YAAD,EAAeC,eAAf,IAAkChB,QAAQ,CAACiB,OAAD,CAAhD;AACA,QAAMC,QAAQ,GAAGf,WAAW,EAA5B;AACA,QAAMgB,SAAS,GAAGjB,UAAU,CAACI,UAAD,CAA5B;AAEAL,EAAAA,SAAS,CAAC,MAAM;AACd;AACA,UAAMmB,GAAG,GAAGC,MAAM,CAACC,QAAP,CAAgBC,IAA5B;AACA,UAAMC,OAAO,GAAGJ,GAAG,CAACK,QAAJ,CAAa,QAAb,CAAhB,CAHc,CAKd;;AACA,QAAID,OAAJ,EAAa;AACX,YAAME,MAAM,GAAGN,GAAG,CAACO,KAAJ,CAAU,QAAV,CAAf;AACAN,MAAAA,MAAM,CAACO,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,IAA7B,EAAmCH,MAAM,CAAC,CAAD,CAAzC;AACAd,MAAAA,OAAO,CAAC,EAAE,GAAGD,IAAL;AAAWG,QAAAA,SAAS,EAAE;AAAtB,OAAD,CAAP;AAEA,YAAMgB,WAAW,GAAG;AAClBC,QAAAA,IAAI,EAAEL,MAAM,CAAC,CAAD;AADM,OAApB,CALW,CASd;;AACG,YAAMM,SAAS,GAAG,8CAAlB;;AACJ,qBAAeC,UAAf,GAA4B;AAC3B,cAAMC,aAAa,GAAG;AACrBC,UAAAA,MAAM,EAAE,MADa;AAErBC,UAAAA,OAAO,EAAE;AACT,4BAAgB,kBADP;AAER,2CAA+B;AAFvB;AAFY,SAAtB;;AAQD,YAAI;AACH,gBAAMC,QAAQ,GAAI,GAAEL,SAAU,EAA9B;AACA,cAAIM,GAAJ;AACA,cAAIC,MAAJ;AACAD,UAAAA,GAAG,GAAG,MAAM,CACX,MAAME,KAAK,CAACH,QAAD,EAAW,EACrB,GAAGH,aADkB;AAErBO,YAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACpBZ,cAAAA,IAAI,EAAED,WAAW,CAACC;AADE,aAAf;AAFe,WAAX,CADA,EAMPa,IANO,EAAZ;AAQA;AACH;AACA;AACG;;AACA,cAAIN,GAAG,IAAIA,GAAG,CAACO,KAAf,EAAsB;AACrBN,YAAAA,MAAM,GAAG,MAAMhC,GAAG,CAACuC,gBAAJ,CAAqBR,GAAG,CAACO,KAAzB,CAAf;;AACA,gBAAIN,MAAM,IAAIA,MAAM,CAAC5B,IAAP,CAAYoC,IAAZ,KAAqB,SAAnC,EAA8C;AAC7CC,cAAAA,YAAY,CAACC,KAAb;AACAD,cAAAA,YAAY,CAACE,OAAb,CAAqB,MAArB,EAA6BR,IAAI,CAACC,SAAL,CAAeL,GAAG,CAACO,KAAnB,CAA7B;AACAG,cAAAA,YAAY,CAACE,OAAb,CAAqB,KAArB,EAA4BR,IAAI,CAACC,SAAL,CAAeJ,MAAM,CAAC5B,IAAP,CAAYwC,IAAZ,CAAiBC,GAAhC,CAA5B;AACAjC,cAAAA,SAAS,CAACkC,UAAV,CAAqB,IAArB;AACArC,cAAAA,eAAe,CAAC,IAAD,CAAf;AACA;AACD,WATD,MASO;AACNA,YAAAA,eAAe,CAAC,KAAD,CAAf;AACAG,YAAAA,SAAS,CAACkC,UAAV,CAAqB,KAArB;AACA;AAED,SA9BD,CA8BE,OAAOC,KAAP,EAAc;AACfC,UAAAA,OAAO,CAACC,GAAR,CAAaF,KAAb;AACA;AACD;;AACDrB,MAAAA,UAAU;AACT;AACC,GA9DQ,EA8DN,CAACtB,IAAD,CA9DM,CAAT;AAiEDV,EAAAA,SAAS,CAAC,MAAM;AACf,QAAGc,YAAY,KAAK,IAApB,EAA0B;AACzBG,MAAAA,QAAQ,CAAC,aAAD,CAAR;AACA;AACD,GAJQ,EAIN,CAACH,YAAD,EAAeC,eAAf,CAJM,CAAT;AASC,sBACE,QAAC,OAAD;AAAA,cACD,CAACD,YAAD,gBACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADC,gBAGM,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAJL;AAAA;AAAA;AAAA;AAAA,UADF;AASD;;GAzFuBL,W;UAGLP,W;;;KAHKO,W","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n// components\nimport Loader from '../loader/loader'\n// style\nimport {Wrapper} from \"./Form.styles\";\n//other\nimport AppContext from \"../../AppContext\";\nimport Api from \"../../api\";\n\n\nrequire('dotenv').config()\n\n\nexport default function LandingPage() {\n  const [data, setData] = useState({ errorMessage: \"\", isLoading: false });\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n  const myContext = useContext(AppContext);        \n\n  useEffect(() => {\n    // Hämtar url från webbläsare\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\");\n\n    // Om github skickar tillbaka kod\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      setData({ ...data, isLoading: true });\n      \n      const requestData = {\n        code: newUrl[1]\n      };\n\n\t  // skickar till backend vad den ska göra\n      const proxy_url = \"http://localhost:1337/api/oauth/authenticate\";\n\t\tasync function getGitInfo() {\n\t\t\tconst defaultConfig = {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\"Access-Control-Allow-Origin\": \"*\"\n\t\t\t\t},\n\t\t\t};\n\n\t\ttry {\n\t\t\tconst endpoint = `${proxy_url}`;\n\t\t\tlet res;\n\t\t\tlet result;\n\t\t\tres = await (\n\t\t\t\tawait fetch(endpoint, {\n\t\t\t\t\t...defaultConfig,\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tcode: requestData.code,\n\t\t\t\t\t})\n\t\t\t\t})).json();\n\n\t\t\t/* HÄR MÅSTE KOLLA SÅ ATT LOGGIN ÄR OK FRÅN VÅRT API SÄTT SEN ALLA PARAMETRAR TILL ANVÄNDAREN\n\t\t\t\tFIXA SEN SÅ ATT HAN NAVIGERAS VIDARE TILL LOGINHOME\n\t\t\t*/\n\t\t\t// Om backend skickar användaruppg, be sen om att logga in användaren\n\t\t\tif (res && res.login) {\n\t\t\t\tresult = await Api.logginUserViaGit(res.login)\n\t\t\t\tif (result && result.data.type === \"success\") {\n\t\t\t\t\tlocalStorage.clear();\n\t\t\t\t\tlocalStorage.setItem('user', JSON.stringify(res.login));\n\t\t\t\t\tlocalStorage.setItem('tag', JSON.stringify(result.data.user.tag));\n\t\t\t\t\tmyContext.toggleAuth(true);\n\t\t\t\t\tsetLoggedInUser(true)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetLoggedInUser(false)\n\t\t\t\tmyContext.toggleAuth(false);\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.log((error))\n\t\t}\n\t}\n\tgetGitInfo();\n\t}\n  }, [data]);\n\n\t\n\tuseEffect(() => {\n\t\tif(loggedInUser === true) {\n\t\t\tnavigate(\"/login/home\")\n\t\t}\n\t}, [loggedInUser, setLoggedInUser])\n\n\n\n\n  return (\n    <Wrapper>\n\t\t{!loggedInUser ? \n\t\t<p>Det gick inte att logga in just nu</p> \n\t\t: (\n        \t<Loader></Loader>\n\t\t)}\n    </Wrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}