{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Othor\\\\dbwebb-kurser\\\\frontendphp\\\\webbclient\\\\src\\\\components\\\\landingPage\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Wrapper } from \"./Form.styles\";\nimport { AppContext } from \"../../AppContext\";\nimport Api from \"../../api\";\nimport Loader from '../loader/loader';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nrequire('dotenv').config();\n\nexport default function LandingPage() {\n  _s();\n\n  const [data, setData] = useState({\n    errorMessage: \"\",\n    isLoading: false\n  });\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n  useEffect(() => {\n    // After requesting Github access, Github redirects back to your app with a code parameter\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\"); // If Github API returns the code parameter\n\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      setData({ ...data,\n        isLoading: true\n      });\n      const requestData = {\n        code: newUrl[1]\n      };\n      const proxy_url = \"http://localhost:1337/api/oauth/authenticate\";\n\n      async function getGitInfo() {\n        const defaultConfig = {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            \"Access-Control-Allow-Origin\": \"*\"\n          }\n        };\n\n        try {\n          const endpoint = `${proxy_url}`;\n          let res;\n          let result;\n          res = await (await fetch(endpoint, { ...defaultConfig,\n            body: JSON.stringify({\n              code: requestData.code\n            })\n          })).json();\n          console.log(res);\n          /* HÄR MÅSTE KOLLA SÅ ATT LOGGIN ÄR OK FRÅN VÅRT API SÄTT SEN ALLA PARAMETRAR TILL ANVÄNDAREN\n          \tFIXA SEN SÅ ATT HAN NAVIGERAS VIDARE TILL LOGINHOME\n          */\n\n          if (res && res.login) {\n            result = await Api.logginUserViaGit(res.login);\n\n            if (result) {\n              setLoggedInUser(true);\n            }\n          } else {\n            setLoggedInUser(true);\n          }\n        } catch (error) {\n          console.log(error);\n        }\n      }\n\n      getGitInfo();\n    }\n  }, [data]);\n  useEffect(() => {\n    if (loggedInUser === true) {\n      navigate(\"/login/home\");\n    }\n  }, [loggedInUser, setLoggedInUser]);\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: loggedInUser == \"Not OK\" ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Det gick inte att logga in just nu\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 3\n    }, this) : /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 10\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, this);\n}\n\n_s(LandingPage, \"JSSceNLD4vZ1ONV4kMV9d4Vgr5M=\", false, function () {\n  return [useNavigate];\n});\n\n_c = LandingPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"LandingPage\");","map":{"version":3,"sources":["C:/Users/Othor/dbwebb-kurser/frontendphp/webbclient/src/components/landingPage/index.js"],"names":["React","useState","useEffect","useContext","useNavigate","Wrapper","AppContext","Api","Loader","require","config","LandingPage","data","setData","errorMessage","isLoading","loggedInUser","setLoggedInUser","Boolean","navigate","url","window","location","href","hasCode","includes","newUrl","split","history","pushState","requestData","code","proxy_url","getGitInfo","defaultConfig","method","headers","endpoint","res","result","fetch","body","JSON","stringify","json","console","log","login","logginUserViaGit","error"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport {Wrapper} from \"./Form.styles\";\nimport { AppContext } from \"../../AppContext\";\nimport Api from \"../../api\";\nimport Loader from '../loader/loader'\n\n\nrequire('dotenv').config()\n\n\nexport default function LandingPage() {\n  const [data, setData] = useState({ errorMessage: \"\", isLoading: false });\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // After requesting Github access, Github redirects back to your app with a code parameter\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\");\n\n    // If Github API returns the code parameter\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      setData({ ...data, isLoading: true });\n      \n      const requestData = {\n        code: newUrl[1]\n      };\n\n\n      const proxy_url = \"http://localhost:1337/api/oauth/authenticate\";\n\t\tasync function getGitInfo() {\n\t\t\tconst defaultConfig = {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\"Access-Control-Allow-Origin\": \"*\"\n\t\t\t\t},\n\t\t\t};\n\n\t\ttry {\n\t\t\tconst endpoint = `${proxy_url}`;\n\t\t\tlet res;\n\t\t\tlet result;\n\t\t\tres = await (\n\t\t\t\tawait fetch(endpoint, {\n\t\t\t\t\t...defaultConfig,\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tcode: requestData.code,\n\t\t\t\t\t})\n\t\t\t\t})).json();\n\n\t\t\tconsole.log(res)\n\t\t\t/* HÄR MÅSTE KOLLA SÅ ATT LOGGIN ÄR OK FRÅN VÅRT API SÄTT SEN ALLA PARAMETRAR TILL ANVÄNDAREN\n\t\t\t\tFIXA SEN SÅ ATT HAN NAVIGERAS VIDARE TILL LOGINHOME\n\t\t\t*/\n\t\t\tif (res && res.login) {\n\t\t\t\tresult = await Api.logginUserViaGit(res.login)\n\t\t\t\tif (result) {\n\t\t\t\t\tsetLoggedInUser(true)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetLoggedInUser(true)\n\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.log((error))\n\t\t}\n\t}\n\tgetGitInfo();\n\t}\n  }, [data]);\n\n\t\n\tuseEffect(() => {\n\t\tif(loggedInUser === true) {\n\t\t\tnavigate(\"/login/home\")\n\t\t}\n\t}, [loggedInUser, setLoggedInUser])\n\n\n\n\n  return (\n    <Wrapper>\n\t\t{loggedInUser == \"Not OK\" ? \n\t\t<p>Det gick inte att logga in just nu</p> \n\t\t: (\n        \t<Loader></Loader>\n\t\t)}\n    </Wrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}