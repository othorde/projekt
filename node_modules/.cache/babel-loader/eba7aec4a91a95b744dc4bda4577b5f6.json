{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Othor\\\\dbwebb-kurser\\\\frontendphp\\\\webbclient\\\\src\\\\routes\\\\LandingPage\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\"; // components\n\nimport Loader from '../../components/Loader'; // style\n\nimport { Wrapper } from \"./Form.styles\"; //other\n\nimport AppContext from \"../../AppContext\";\nimport Api from \"../../Api\";\nimport { PROXY_URL, defaultConfigAuthenticate } from '../../config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nrequire('dotenv').config();\n/* Hämtar ut url koden av github, som redirectar hit. Skickar sedan koden till backend\n   så att den kan göra de request som behövs till github. \n   Får sedan tillbaka användaruppg, som används för att logga in användaren\n   genom vårt api.\n*/\n\n\nexport default function LandingPage() {\n  _s();\n\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n  const myContext = useContext(AppContext);\n  useEffect(() => {\n    // Hämtar url från webbläsare\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\"); // Om github skickar tillbaka kod, ta ut koden ur URL strängen\n\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      const requestData = {\n        code: newUrl[1]\n      };\n      getGitInfo(requestData);\n    }\n  }, []);\n\n  async function getGitInfo(requestData) {\n    setLoggedInUser(\"Not OK\");\n    myContext.toggleAuth(false);\n\n    try {\n      let res;\n      let result;\n      res = await (await fetch(PROXY_URL, { ...defaultConfigAuthenticate,\n        body: JSON.stringify({\n          code: requestData.code\n        })\n      })).json();\n      /* loggar in genom api och sätter user värden i localStorage samt i hook */\n\n      if (res && res.login) {\n        result = await Api.logginUserViaGit(res.login);\n\n        if (result && result.data.type === \"success\") {\n          localStorage.clear();\n          localStorage.setItem('user', JSON.stringify(res.login));\n          localStorage.setItem('tag', JSON.stringify(result.data.user.tag));\n          localStorage.setItem('id', JSON.stringify(result.data.user.id));\n          const user = {\n            user: res.login,\n            tag: result.data.user.tag,\n            id: result.data.user.id\n          };\n          myContext.setUserValues(user);\n          myContext.toggleAuth(true);\n          setLoggedInUser(true);\n        }\n      }\n    } catch (error) {\n      setLoggedInUser(\"Not OK\");\n      myContext.toggleAuth(false);\n    }\n  }\n\n  useEffect(() => {\n    let tag = localStorage.getItem(\"tag\");\n    loggedInUser === true && tag && navigate(\"/login/home\");\n  }, [loggedInUser, setLoggedInUser]);\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: !loggedInUser === \"Not OK\" ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Det gick inte att logga in just nu\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 3\n    }, this) : /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 10\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n}\n\n_s(LandingPage, \"wUqvUK37ZuzBwWQzbG3ZOQ+Tb70=\", false, function () {\n  return [useNavigate];\n});\n\n_c = LandingPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"LandingPage\");","map":{"version":3,"sources":["C:/Users/Othor/dbwebb-kurser/frontendphp/webbclient/src/routes/LandingPage/index.js"],"names":["React","useState","useEffect","useContext","useNavigate","Loader","Wrapper","AppContext","Api","PROXY_URL","defaultConfigAuthenticate","require","config","LandingPage","loggedInUser","setLoggedInUser","Boolean","navigate","myContext","url","window","location","href","hasCode","includes","newUrl","split","history","pushState","requestData","code","getGitInfo","toggleAuth","res","result","fetch","body","JSON","stringify","json","login","logginUserViaGit","data","type","localStorage","clear","setItem","user","tag","id","setUserValues","error","getItem"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n// components\nimport Loader from '../../components/Loader'\n// style\nimport {Wrapper} from \"./Form.styles\";\n//other\nimport AppContext from \"../../AppContext\";\nimport Api from \"../../Api\";\nimport {PROXY_URL, defaultConfigAuthenticate} from '../../config'\n\nrequire('dotenv').config()\n\n/* Hämtar ut url koden av github, som redirectar hit. Skickar sedan koden till backend\n   så att den kan göra de request som behövs till github. \n   Får sedan tillbaka användaruppg, som används för att logga in användaren\n   genom vårt api.\n*/\nexport default function LandingPage() {\n  const [loggedInUser, setLoggedInUser] = useState(Boolean);\n  const navigate = useNavigate();\n  const myContext = useContext(AppContext);        \n\nuseEffect(() => {\n    // Hämtar url från webbläsare\n    const url = window.location.href;\n    const hasCode = url.includes(\"?code=\");\n\n    // Om github skickar tillbaka kod, ta ut koden ur URL strängen\n    if (hasCode) {\n      const newUrl = url.split(\"?code=\");\n      window.history.pushState({}, null, newUrl[0]);\n      \n      const requestData = {\n        code: newUrl[1]\n      };\n\t  getGitInfo(requestData);\n\t}\n}, []);\n\n\n\tasync function getGitInfo(requestData) {\n\t\tsetLoggedInUser(\"Not OK\")\n\t\tmyContext.toggleAuth(false);\n\n\t\ttry {\n\t\t\tlet res;\n\t\t\tlet result;\n\t\t\tres = await (\n\t\t\t\tawait fetch(PROXY_URL, {\n\t\t\t\t\t...defaultConfigAuthenticate,\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tcode: requestData.code,\n\t\t\t\t\t})\n\t\t\t\t})).json();\n\t\t\t\t/* loggar in genom api och sätter user värden i localStorage samt i hook */\n\t\t\tif (res && res.login) {\n\t\t\t\tresult = await Api.logginUserViaGit(res.login)\n\t\t\t\tif (result && result.data.type === \"success\") {\n\t\t\t\t\tlocalStorage.clear();\n\t\t\t\t\tlocalStorage.setItem('user', JSON.stringify(res.login));\n\t\t\t\t\tlocalStorage.setItem('tag', JSON.stringify(result.data.user.tag));\n\t\t\t\t\tlocalStorage.setItem('id', JSON.stringify(result.data.user.id));\n\n\t\t\t\t\tconst user = {\n\t\t\t\t\t\tuser: res.login,\n\t\t\t\t\t\ttag: result.data.user.tag,\n\t\t\t\t\t\tid: result.data.user.id,\n\t\t\t\t\t}\n\t\t\t\t\tmyContext.setUserValues(user)\n\t\t\t\t\tmyContext.toggleAuth(true);\n\t\t\t\t\tsetLoggedInUser(true)\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tsetLoggedInUser(\"Not OK\")\n\t\t\tmyContext.toggleAuth(false);\n\t\t}\n\t}\n\n\n\n\n\n\n\n\n\t\n\tuseEffect(() => {\n\t\tlet tag = localStorage.getItem(\"tag\");\n\t\t(loggedInUser === true && tag) && navigate(\"/login/home\")\n\t}, [loggedInUser, setLoggedInUser])\n\n\n  return (\n    <Wrapper>\n\t\t{!loggedInUser === \"Not OK\" ? \n\t\t<p>Det gick inte att logga in just nu</p> \n\t\t: (\n        \t<Loader></Loader>\n\t\t)}\n    </Wrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}